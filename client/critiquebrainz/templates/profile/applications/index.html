{% extends 'profile/base.html' %}

{% block title %}{{ _('Applications') }} - CritiqueBrainz{% endblock %}

{% from 'macros.html' import scope_desc %}

{% block content %}
<div class="clearfix">
  <h2 class="pull-left">{{ _('Applications') }}</h2>
  <a href="{{ url_for('profile_applications.create') }}" class="btn btn-success pull-right" style="margin-top: 20px;">
    <span class="glyphicon glyphicon-asterisk"></span> {{ _('Create new application') }}
  </a>
</div>
<hr />

<h4>{{ _('Your applications') }}</h4>
{% if not applications %}
  <p class="lead" style="text-align: center;">{{ _('No applications found') }}</p>
{% else %}
  <table class="table table-hover">
    <thead>
      <tr>
        <th>{{ _('Name') }}</th>
        <th>{{ _('Website') }}</th>
        <th>{{ _('Client ID') }}</th>
        <th>{{ _('Client secret') }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for app in applications %}
        <tr>
          <td>{{ app.name }}</td>
          <td>{{ app.website }}</td>
          <td>{{ app.client_id }}</td>
          <td>{{ app.client_secret }}</td>
          <td>
            <a class="btn btn-primary btn-xs" href="{{ url_for('profile_applications.edit', client_id=app.client_id) }}">{{ _('Modify') }}</a>
            <a class="btn btn-danger btn-xs" href="{{ url_for('profile_applications.delete', client_id=app.client_id) }}">{{ _('Delete') }}</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
<div class="alert alert-info">{{ _('Developer documentation is available at %(link)s.', link='<a href="http://critiquebrainz.rtfd.org/">critiquebrainz.rtfd.org</a>'|safe) }}</div>

<hr />

<h4>{{ _('Authorized applications') }}</h4>
{% if not tokens %}
  <p class="lead" style="text-align: center;">{{ _('No authorized applications found') }}</p>
{% else %}
  <table class="table table-hover">
    <thead>
      <tr>
        <th>{{ _('Name') }}</th>
        <th>{{ _('Website') }}</th>
        <th>{{ _('Access') }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for token in tokens %}
        <tr>
          <td><b>{{ token.client.name }}</b></td>
          <td>{{ token.client.website }}</td>
          <td>
            {% if token.scopes %}
              <ul>
                {% set scopes = token.scopes.split() %}
                {% for scope in scopes %}
                  <li>{{ scope_desc(scope) }}</li>
                {% endfor %}
              </ul>
            {% else %}
              {{ _('No special requirements') }}
            {% endif %}
          </td>
          <td>
            <a class="btn btn-danger btn-xs" href="{{ url_for('profile_applications.token_delete', client_id=token.client.client_id) }}">{{ _('Revoke access') }}</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{% endblock %}
