{% extends 'base.html' %}

{% block title %}{{ artist.name }} - CritiqueBrainz{% endblock %}

{% block content %}
<h2>
  {{ artist.name }}
  {% if artist.disambiguation %}
    <small>({{ artist.disambiguation }})</small>
  {% endif %}
</h2>

<div class="row">
  <div class="col-sm-9">
    <h4>Discography</h4>
    <ul class="nav nav-tabs">
      <li {% if release_type=='album' %}class="active"{% endif %}>
        <a href="{{ url_for('artist.entity', id=artist.id) }}?release_type=album">Albums</a>
      </li>
      <li {% if release_type=='single' %}class="active"{% endif %}>
        <a href="{{ url_for('artist.entity', id=artist.id) }}?release_type=single">Singles</a>
      </li>
      <li {% if release_type=='ep' %}class="active"{% endif %}>
        <a href="{{ url_for('artist.entity', id=artist.id) }}?release_type=ep">EPs</a>
      </li>
      <li {% if release_type=='broadcast' %}class="active"{% endif %}>
        <a href="{{ url_for('artist.entity', id=artist.id) }}?release_type=broadcast">Broadcasts</a>
      </li>
      <li {% if release_type=='other' %}class="active"{% endif %}>
        <a href="{{ url_for('artist.entity', id=artist.id) }}?release_type=other">Other releases</a>
      </li>
    </ul>
    {% if count==0 %}
      <p class="lead" style="text-align:center; margin-top:20px;">No releases found</p>
    {% else %}
      <div id="release-groups" class="row">
        {% for release_group in release_groups %}
          <div class="col-sm-4 col-md-4 col-lg-3">
            {% set has_reviews = (release_group.review_count > 0) %}
            <div class="thumbnail clearfix {% if has_reviews %}reviewed{% endif %}">
              {% if has_reviews %}
                <div class="review-count">
                  {{ release_group.review_count }}
                  {% if release_group.review_count==1 %}review{% else %}reviews{% endif %}
                </div>
              {% endif %}
              <div class="cover-art-container">
                <a href="{{ url_for('release_group.entity', id=release_group.id) }}"><img class="img-responsive"></a>
                <script>
                  $("img").last()
                      .on("error", function () { $(this).attr("src", "/static/img/missing-art.png"); })
                      .attr("src", "//coverartarchive.org/release-group/{{ release_group.id }}/front-250");
                </script>
              </div>
              <div class="caption">
                <div class="release-group-title">
                  <a href="{{ url_for('release_group.entity', id=release_group.id) }}">{{ release_group.title }}</a>
                </div>
                <div class="clearfix">
                  <div class="pull-left">{{ release_group['primary-type'] }}</div>
                  <div class="pull-right">{{ release_group['first-release-date'][:4] }}</div>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
        <div class="clearfix"></div>
        <div class="col-md-12">
          <ul class="pagination">
            {% set pages = count//limit %}
            {% if count%limit %}
              {% set pages = pages+1 %}
            {% endif %}
            {% if pages>1 %}
              {% for p in range(pages) %}
                {% set p_offset = p*limit %}
                <li {% if offset == p_offset %}class="active"{% endif %}>
                  <a href="{{ url_for('artist.entity', id=id, release_type=release_type, offset=p*limit) }}">{{ p+1 }}</a>
                </li>
              {% endfor %}
            {% endif %}
          </ul>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="col-sm-3">
    <h4>Artist information</h4>
    {% if artist.type %}<p class="text-muted">{{ artist.type }}</p>{% endif %}

    {% if artist['band-members'] %}
      <b>
        {% if artist.type and artist.type == 'Person' %}
          Member of
        {% else %}
          Members
        {% endif %}
      </b>
      <ul class="list-unstyled">
        {% for member in artist['band-members'] %}
          <li>
            <a href="{{ url_for('artist.entity', id=member.artist.id) }}"
              {% if member.begin or member.end %}title="{{ member.begin }} - {{ member.end }}"{% endif %}>
              {{ member.artist.name }}</a>
            {% if member.artist.disambiguation %}<span class="text-muted">({{ member.artist.disambiguation }})</span>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if artist['url-relation-list'] %}
      <b>External links</b>
      <ul class="list-unstyled external-links">
        {% for url in artist['url-relation-list'] %}
          <li class="clearfix">
            <div class="favicon-container pull-left">
              {% if url.icon %}
                <img src="{{ url_for('static', filename='favicons/'+url.icon) }}" />
              {% else %}
                <img src="{{ url_for('static', filename='favicons/external-16.png') }}" />
              {% endif %}
            </div>
            <a href="{{ url.target }}">{{ url.name }}</a>
            {% if url.provider %}<span class="text-muted">({{ url.provider }})</span>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    <p><a href="//musicbrainz.org/artist/{{ artist.id }}"><em>Edit on MusicBrainz</em></a></p>
  </div>
</div>
{% endblock %}
